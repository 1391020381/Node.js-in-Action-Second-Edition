* Connect 如何用中间件搭建简单的Web程序,以及中间件的顺序的重要性。
  
## 了解Connect中间件的工作机制
* Connect中间件就是JavaScript函数。这个函数一般会有三个参数：请求对象、响应对象、以及一个名为next的回调函数。一个中间件完成自己的工作,要执行后续的中间件时,可以调用这个回调函数。
* use()函数返回的是Connect程序的实例,支持方法链。不过并不一定要把.use()链起来。
* 中间件的顺序会对程序的行为产生显著的影响。漏掉next()能停止执行。也可以通过组合中间件实现用户认证之类的功能。


## 创建可配置的中间件
* 为了做到可配置,中间件一般会遵循一个简单的惯例:用一个函数返回另一个函数(闭包)。这种可配置中间件的基本结构如下：
```
function setup(options){
    // 设置逻辑

    // 在这里做中间件的初始化
    return function (req,res,next){
        // 中间件逻辑
        // 即使被外部函数返回了,仍然可以访问options
    }
}

// 这种中间件的用法如下：
app.use(setup({some:'options'}))
```
### 使用错误处理中间件
* Connect中有一种用来处理错误的中间件变体,跟常规的中间件相比,除了请求、响应对象外,错误处理中间件的参数中还多了一个错误对象。

* 用NODE_ENV设定程序的模式 Connect一般会根据环境变量 NODE_ENV(process.env.NODE_ENV)来切换不同服务器环境(比如生产和开发环境)


### 设置环境变量
* 要在 UNIX系统中设置环境变量,可以用这个命令：
```
NODE_ENV = production node app

```

* 在 Windows 中用这个
```
set NODE_ENV = production

node app

```

### __dirname
* Node中的__dirname(前面有两个下划线)是个全局变量,表示当前运行的文件所在的目录。在开发时,这个目录通常就是当前工作目录(CWD),但在生产环境中,这个文件可能运行在其他的目录中。__dirname有助于保持路径在各种环境中的一致性。